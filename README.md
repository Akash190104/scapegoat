Scapegoat ![travis image](https://travis-ci.org/sksamuel/scalac-scapegoat-plugin.svg?branch=master)
==========

Scapegoat is a Scala static code anaylzer, what is more colloquially known as a code lint tool or linter. Scapegoat works in a similar vein to Java's [FindBugs](http://findbugs.sourceforge.net/) or [checkstyles](http://checkstyle.sourceforge.net/), or Scala's [Scalastyle](https://github.com/scalastyle/scalastyle).

A static code anaylzer is a tool that flag suspicious langage usage in code. This can include behavior likely to lead or bugs, non idiomatic usage of a language, or just code that doesn't conform to specified style guidelines.

**What's the difference between this project and Scalastyle (or others)?**

Scalastyle is a similar linting tool which focuses mostly on enforcing style/code standards. There's no problems running multiple analysis tools on the same codebase. In fact it could be beneficial as the total set of possible warnings is the union of the inspections of all the enabled tools. The worst case is that the same warnings might be generated by multiple tools.

### Usage
Scapegoat is developed as a scala compiler plugin, which can then be used inside your build tool.

See: [sbt-scapegoat](https://github.com/sksamuel/sbt-scapegoat) for SBT integration.

### Screenshot

Here is a screen shot of the type of report scapegoat generates.

![screenshot](https://raw.githubusercontent.com/sksamuel/scapegoat/master/screenshot1.png)

### False positives

Please note that scapegoat is a new project. While it's been tested on some common open source projects, there is still a good chance you'll find false positives. Please open up issues if you run into these so we can fix them.

### Inspections

The currently implemented inspections are as follows. An overview list is given, followed by a more detailed description of each inspection after the list.

|Name|Brief Description|
|----|-----------|
| ArraysInFormat| Checks for arrays passed to String.format |
| ArraysToString| Checks for explicit toString calls on arrays |
| AvoidSizeEqualsZero | Traversable.size can be slow for some data structure, prefer .isEmpty |
| AvoidSizeNotEqualsZero | Traversable.size can be slow for some data structure, prefer .nonEmpty |
| AsInstanceOf| Checks for use of `asInstanceOf` |
| BigDecimalDoubleConstructor| Checks for use of `BigDecimal(double)` which can be unsafe |
| BrokenOddness| checks for a % 2 == 1 for oddness, but this breaks for negative numbers |
| CatchNpe| Checks for try blocks that catch null pointer exceptions |
| CollectionNamingConfusion| Checks for variables that are confusingly named |
| CollectionNegativeIndex| Checks for negative access on a sequence |
| CollectionPromotionToAny| Checks for collection operations that promote the collection to `Any` |
| ComparingFloatingPointTypes| Checks for equality checks on floating point types |
| ComparingUnrelatedTypes| Checks for equality comparisons that cannot succeed |
| ComparisonWithSelf| Checks for equality checks with itself |
| ConstantIf| Checks for code where the if condition compiles to a constant |
| DivideByOne| Checks for divide by one, which always returns the original value |
| DuplicateMapKey| Checks for duplicate key names in Map literals |
| EitherGet| Checks for use of .get on Left or Right |
| EmptyCatchBlock| Checks for swallowing exceptions |
| EmptyIfBlock| Checks for empty if blocks |
| EmptyInterpolatedString| Looks for interpolated strings that have no arguments |
| EmptyMethod| Looks for empty methods |
| EmptySynchronizedBlock| Looks for empty synchronized blocks |
| EmptyTryBlock| Looks for empty try blocks |
| ExpressionAsStatement| Looks for expressions executed for their side effects |
| FilterHeadOption| `.filter(x => Bool).headOption` can be replaced with `find(x => Bool)` |
| FilterIsEmpty| `.filter(x => Bool).isEmpty` can be replaced with `!exists(x => Bool)` |
| FilterOptionAndGet| `.filter(_.isDefined).map(_.get)` can be replaced with `flatten` |
| FilterSize| `.filter(x => Bool).size` can be replaced more concisely with with `count(x => Bool)` |
| FindIsDefined| `find(x => Bool).isDefined` can be replaced with `exist(x => Bool)` |
| IllegalFormatString| Looks for invalid format strings |
| IncorrectlyNamedExceptions| Checks for exceptions that are not called *Exception and vice versa |
| IncorrectNumberOfArgsToFormat| Checks for wrong number of arguments to `String.format` |
| InvalidRegex| Checks for invalid regex literals |
| IsInstanceOf| Checks for use of `isInstanceOf` |
| JavaConversionsUse| Checks for use of implicit Java conversions |
| ListSize| Checks for `List.size` which is O(n). |
| ModOne| Checks for `x % 1` which will always return `1` |
| NanComparison| Checks for `x == Double.NaN` which will always fail |
| NullUse| Checks for use of `null` |
| OptionGet| Checks for `Option.get` |
| OptionSize| Checks for `Option.size` |
| ParameterlessMethodReturnsUnit| Checks for `def foo : Unit` |
| PartialFunctionInsteadOfMatch | Warns when you could use a partial function directly instead of a match block |
| PreferSeqEmpty| Checks for Seq() when could use Seq.empty |
| PreferSetEmpty| Checks for Set() when could use Set.empty |
| ProductWithSerializableInferred| Checks for vals that have `Product with Serializable` as their inferred type |
| RedundantFinalizer| Checks for empty finalizers. |
| TraversableHead| Looks for unsafe usage of `Traversable.head` |
| TryGet| Checks for use of `Try.get` |
| UnnecessaryIf| Checks for code like `if (expr) true else false` |
| UnnecessaryReturnUse| Checks for use of `return` keyword in blocks |
| UnsafeContains| Checks for `List.contains(value)` for invalid types |
| UnusedMethodParameter| Checks for unused method parameters |
| UseSqrt| Checks for use of Math.pow for calculating sqrt |
| VarUse| Checks for use of `var` |
| WhileTrue| Checks for code that uses a `while(true)` or `do { } while(true)` block. |
| ZeroNumerator | Checks for dividing by 0 by a number, eg `0 / x` which will always return `0` |

### Inspections

##### Arrays to string

Checks for explicit toString calls on arrays. Since toString on an array does not perform a deep toString, like say scala's List, this is usually a mistake.

##### ComparingUnrelatedTypes

Checks for equality comparisons that cannot succeed because the types are unrelated. Eg `"string" == BigDecimal(1.0)`. The scala compiler has a less strict version of this inspection.

##### ConstantIf

Checks for if statements where the condition is always true or false. Not only checks for the boolean literals, but also any expression that the compiler is able to turn into a constant value. Eg, `if (0 < 1) then else that`

##### IllegalFormatString

Checks for a format string that is not invalid, such as invalid conversions, invalid flags, etc. Eg, `"% s"`, `"%qs"`, `%.-4f"`

##### IncorrectNumberOfArgsToFormat

Checks for an incorrect number of arguments to String.format. Eg, `"%s %s %f".format("need", "three")` flags an error because the format string specifies 3 parameters but the call only provides 2.

##### List size

Checks for .size on an instance of List. Eg, `val a = List(1,2,3); a.size`

*Rationale* List.size is O(n) so for performance reasons if .size is needed on a list that could be large, consider using an alternative with O(1), eg Array, Vector or ListBuffer.

##### Redundant finalizer

Checks for empty finalizers. This is redundant code and should be removed. Eg, `override def finalize : Unit = { }`

##### UnnecessaryReturnUse

Checks for use of return in a function or method. Since the final expression of a block is always the return value, using return is unnecessary. Eg, `def foo = { println("hello"); return 12; }`

##### While true

Checks for code that uses a `while(true)` or `do { } while(true)` block.

*Rationale*: This type of code is usually not meant for production as it will not return normally. If you need to loop until interrupted then consider using a flag.

### Other static analysis tools:

* ScalaStyle (Scala) - https://github.com/scalastyle/scalastyle/wiki
* Linter (Scala) - https://github.com/HairyFotr/linter
* WartRemover (Scala) - https://github.com/typelevel/wartremover
* Findbugs(JVM) - http://findbugs.sourceforge.net/bugDescriptions.html
* CheckStyle(Java) - http://checkstyle.sourceforge.net/availablechecks.html
* PMD(Java) - http://pmd.sourceforge.net/pmd-5.0.3/rules/index.html
* Error-prone(Java) - https://code.google.com/p/error-prone/wiki/BugPatterns
* CodeNarc(Groovy) - http://codenarc.sourceforge.net/codenarc-rule-index.html
* PVS-Studio(C++) - http://www.viva64.com/en/d/
* Coverity(C++) - http://www.slideshare.net/Coverity/static-analysis-primer-22874326 (6,7)
* CppCheck(C++) - http://cppcheck.sourceforge.net/
* OCLint (C++/ObjC) - http://docs.oclint.org/en/dev/rules/index.html
* JSLink (Javascript) - http://www.jshint.com/
* JavascriptLink (Javascript) - http://www.javascriptlint.com/
* ClosureLinkter (Javascript) - https://developers.google.com/closure/utilities/
